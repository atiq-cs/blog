

<!DOCTYPE HTML>
<!--
	Solid State by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
		<title>Notes from Atiq - Powershell Core Useful Commands</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<!--[if lte IE 8]><script src="/assets/js/ie/html5shiv.js"></script><![endif]-->
		<link rel="stylesheet" href="/assets/sass/main.css" />
		<!--[if lte IE 9]><link rel="stylesheet" href="/assets/sass/ie9.css" /><![endif]-->
		<!--[if lte IE 8]><link rel="stylesheet" href="/assets/sass/ie8.css" /><![endif]-->
        

	</head>
	<body>

		<!-- Page Wrapper -->
			<div id="page-wrapper">
				
				<!-- Header -->
				<header id="header">
					<h1><a href="/">Notes from Atiq</a></h1>
					<nav>
						<a href="#menu">Menu</a>
					</nav>
				</header>

				<!-- Menu -->
				<nav id="menu">
					<div class="inner">
						<h2>Menu</h2>
						<ul class="links">
							        <li><a href="/posts">Archive</a></li>
        <li><a href="/tags">Tags</a></li>
        <li><a href="/about">About Me</a></li>

						</ul>
						<a href="#" class="close">Close</a>
					</div>
				</nav>


    
<section id="banner">
  <div class="inner">
    <h2>Powershell Core Useful Commands</h2>
            <p><em>Published on Tuesday, November 19, 2019</em></p>
                    <a role="button" href="/tags/Powershell-Core" class="button small">Powershell Core</a>
                <a role="button" href="/tags/pwsh" class="button small">pwsh</a>
                <a role="button" href="/tags/system-administration" class="button small">system administration</a>
  </div>
</section>

				<!-- Main -->
				<section id="wrapper">
					<section class="wrapper style2">
						<div class="inner">
							

<p><em>This article formerly titled as 'Powershell Frequently Used Commands. Even though the article is titled pwsh it draws back on the topic of Powershell as well.'</em></p>
<p>Please be aware of notation below in command outlines. <code>$</code> represents a command and rests of the lines following that line are output. Powershell is superset of traditional command prompt. Hence, all usual binaries still run on powershell for example, <code>takeown</code>.</p>
<h2 id="initialization-of-shell">Initialization of Shell</h2>
<p><em>This section is for my personalized shell; please feel free to skip it.</em></p>
<p>Since move to pwsh this has changed to this (sorry for replacing simple Console, but it uses an inconvenient Env:WinDir/ symbolic link),</p>
<pre><code>pwsh -NoExit D:\pwsh\Init.ps1
</code></pre>
<p>For Machine Learning customized shell, I try adding an arg,</p>
<pre><code>pwsh -NoExit D:\pwsh\Init.ps1 ML
</code></pre>
<h2 id="new-to-pwsh">New to pwsh?</h2>
<p>clear-host is equivalent to cls
<code>Get-Location</code> instead of pwd`
ls, cat, popd, pushd etc still work</p>
<p>Write-Host is equivalent to echo. For example,</p>
<pre><code>echo 'hello'
</code></pre>
<p>works just fine.</p>
<p>ps is equivalent to Get-Process or to List processes or doing <code>tasklist</code>.
Stop-Proccess instead of taskkill</p>
<p>Example of starting pwsh with an initiazation script or calling a script with an arg,</p>
<pre><code>Start-Process pwsh -ArgumentList '-NoExit', 'Init-App.ps1 foo' -ErrorAction 'stop'
</code></pre>
<p>above, <code>foo</code> is argument.</p>
<h2 id="application-run-examples">Application Run Examples</h2>
<p><code>Start</code> is an alias of <code>Start-Process</code></p>
<h3 id="cmdlets">Cmdlets</h3>
<h3 id="start-process">Start-Process</h3>
<p>Here are some handy cmds,</p>
<pre><code>Start DevEnv /Edit, Stream-Converter.ps1
Start TeamViewer
Start CVpn-Client

Start Atom
</code></pre>
<p>where I link <code>CVpn-Client</code> to <code>C:\Program Files (x86)\Cisco\Cisco AnyConnect Secure Mobility Client\vpnui.exe</code>,</p>
<p>and, atom is usually linked to <code>C:\Users\atiq\AppData\Local\atom\atom.exe</code></p>
<p>Syntax for microsoft store apps,</p>
<pre><code>Start Microsoft-Edge:https://google.com
Start Skype:
</code></pre>
<p>For passing arguments to an application we can either add it right after the app name with a seperating space,</p>
<pre><code>Start Notepad++ file_path
</code></pre>
<p>Or, specify it in <code>ArgumentList</code>,</p>
<pre><code>Start Notepad++ -ArgumentList file_path
</code></pre>
<p>However, it's tricky if passed argument for example, <code>file_path</code> above contains a space character.</p>
<p>To make it work, we need to double quote them <a href="https://stackoverflow.com/questions/22840882/powershell-opening-file-path-with-spaces">ref</a>,</p>
<pre><code>Start Notepad++ -ArgumentList &quot;`&quot;D:\Cool Soft\my awesome file.txt`&quot;&quot;
</code></pre>
<h2 id="file-management">File Management</h2>
<p>Filter files containing name pattern,</p>
<pre><code>gci -filter '*word*'
</code></pre>
<p>Create directory,</p>
<pre><code>New-Item c:\scripts\Windows PowerShell -type directory
</code></pre>
<p>Create file,</p>
<pre><code>New-Item c:\scripts\new_file.txt -type file
</code></pre>
<h2 id="balanced-power-options">Balanced Power options</h2>
<p>Turn hibernation off (run from elevated PS),</p>
<pre><code>powercfg.exe /h off
</code></pre>
<p>Open Power Options Window,</p>
<pre><code>Show-ControlPanelItem -Name &quot;Power Options&quot;
</code></pre>
<p>List Power plans,</p>
<pre><code>$ powercfg list
Existing Power Schemes (* Active)
-----------------------------------
Power Scheme GUID: 381b4222-f694-41f0-9685-ff5bb260df2e  (Balanced) *
Power Scheme GUID: 433299bd-efc0-474e-a61e-4a940c85e632  (Timers off (Presentation))
Power Scheme GUID: 496d75e1-8cba-4d72-b778-535d67c976ea  (Airplane)
</code></pre>
<p>How to export Balanced plan (we copy paste id from output of above command),</p>
<pre><code>powercfg -Export D:\Efficient_BP.pow 381b4222-f694-41f0-9685-ff5bb260df2e
</code></pre>
<p>automate importing registry (requires privilege) ref,</p>
<pre><code>reg import 'D:\Soft\reg files soft settings\app_paths\KeePass.reg'
</code></pre>
<h2 id="control-panel-cmdlet">Control Panel Cmdlet</h2>
<p>Handy cmds follow, <a href="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.management/show-controlpanelitem">ref</a> to access sys properties,</p>
<pre><code>Show-ControlPanelItem -Name System
</code></pre>
<p>Names supported by <code>Show-ControlPanelItem</code>,</p>
<ul>
<li>Network and Sharing Center</li>
<li>Device Manager</li>
<li>Programs and Features</li>
<li>Default Programs</li>
</ul>
<p>For, Sound mouse etc we do,</p>
<ul>
<li>Sound</li>
<li>Mouse</li>
</ul>
<h2 id="network-cmdlets">Network Cmdlets</h2>
<p>Ping hosts,</p>
<pre><code>Test-Connection -Count 64 google.com
Test-Connection -Count 1024 google.com
</code></pre>
<p>host <code>bing.com</code> does not reply to ICMP requests anymore, hence it's not worth trying <code>Test-Connection bing.com</code>.</p>
<p>if help modules are outdated this updates it,</p>
<pre><code>Update-Help
</code></pre>
<p>More network related cmdlets or commands are at <a href="wifi-cmd">wifi cmd article</a></p>
<h2 id="other-cmdlets">Other Cmdlets</h2>
<p>Get list of running processes (unique),</p>
<pre><code>Get-Process | Select-Object -Unique Path
</code></pre>
<p>When Windows Explorer or taskbar has trouble,</p>
<pre><code>Stop-Process -Name explorer
</code></pre>
<p>Rename Machine,</p>
<pre><code>Rename-Computer -NewName JohnPC -Restart
</code></pre>
<p>Event Log,</p>
<pre><code>Show-EventLog
</code></pre>
<p>Show console host info,</p>
<pre><code>$ Get-Host
Name             : ConsoleHost
Version          : 6.2.3
InstanceId       : cddce532-924c-4a66-a671-bbea53caf430
UI               : System.Management.Automation.Internal.Host.InternalHostUserInterface
CurrentCulture   : en-US
CurrentUICulture : en-US
PrivateData      : Microsoft.PowerShell.ConsoleHost+ConsoleColorProxy
DebuggerEnabled  : True
IsRunspacePushed : False
Runspace         : System.Management.Automation.Runspaces.LocalRunspace
</code></pre>
<p>How to uninstall store application i.e., skype</p>
<pre><code>Get-AppxPackage Microsoft.SkypeApp | Remove-AppxPackage
</code></pre>
<p>Get Software List,</p>
<pre><code>Get-WmiObject -Class Win32_Product -Filter &quot;Name = 'Java 8 (64 bit)'&quot;
</code></pre>
<p>How to uninstall application,</p>
<pre><code>$app = Get-WmiObject -Class Win32_Product -Filter &quot;Name = 'Java 8 (64-bit)'&quot;
$app.Uninstall()
</code></pre>
<h2 id="service-management">Service Management</h2>
<p>Get list of services currently running,</p>
<pre><code>Get-Service | Where-Object {$_.Status -eq &quot;Running&quot;}
</code></pre>
<p>Start a service,</p>
<pre><code>Start-Service -Name VPNAgent
</code></pre>
<p>Stop one,</p>
<pre><code>Stop-Service -Name VPNAgent
</code></pre>
<h2 id="scripting-using-pwsh">Scripting using pwsh</h2>
<p>These basic stuffs might come handy,</p>
<p>Passing all arguments, untouched to another script,</p>
<pre><code>$saArgs = $args[0 .. ($args.Count)]
&amp; &quot;$Env:HOME\ss.ps1&quot; $saArgs
</code></pre>
<h3 id="type-conversion">Type Conversion</h3>
<p>This part also demonstrates how to use some datatype libraries in commands.</p>
<p>Example 1, how do we find ascii number of a bunch of characters?</p>
<pre><code>$ [int[]][char[]] 'abcd'
97
98
99
100
</code></pre>
<p>Additionally, to find ascii number of single char,</p>
<pre><code>$ [int][char] 'z'
122
</code></pre>
<p>Moroever we can call <code>Array.Sort</code> in following way,</p>
<pre><code>$a = [int[]] &#64;(9,5)
[Array]::Sort($a)
</code></pre>
<p>Because these literatls i.e., 'xxx' in powershell is considered as string literal like python.</p>
<pre><code>$ 'z'.gettype()
IsPublic IsSerial Name                                     BaseType
-------- -------- ----                                     --------
True     True     String                                   System.Object
</code></pre>
<h4 id="mathematics-library">Mathematics Library</h4>
<p>Example usage of .net math library, using old friend the <code>power</code> method,</p>
<pre><code>[Math]::Pow(2,13)
</code></pre>
<p>Or finding a square root,</p>
<pre><code>[Math]::Sqrt(9)
</code></pre>
<h4 id="string-helpers">String Helpers</h4>
<p>nll or empty related where <code>$ConfigName</code> is an example variable,</p>
<pre><code>[string]::IsNullOrEmpty($ConfigName)
[string]::IsEmpty($ConfigName)
[string]::Empty($ConfigName)
</code></pre>
<p>substring example,</p>
<pre><code>if ($loc.EndsWith(&quot;\&quot;)) {
    return $loc.Substring(0, $loc.Length-1)
}
</code></pre>
<p>which is fine to be replaced with,</p>
<pre><code>if (($lastindex = [int] $loc.lastindexof('\')) -ne -1) {
    return $loc.Substring(0, $lastindex)
}
</code></pre>
<h2 id="show-os-version">Show OS Version</h2>
<p>Using Net Framework Library,</p>
<pre><code>$ [Environment]::OSVersion
Platform ServicePack Version      VersionString
-------- ----------- -------      -------------
Win32NT             10.0.18362.0 Microsoft Windows NT 10.0.18362.0

$ [Environment]::OSVersion.Version
Major  Minor  Build  Revision
-----  -----  -----  --------
10     0      18362  0
</code></pre>
<p>Additionally, we can do this inspecting <code>hal.dll</code>,</p>
<pre><code>$ [Version](Get-ItemProperty -Path &quot;$($Env:Windir)\System32\hal.dll&quot; -ErrorAction SilentlyContinue).VersionInfo.FileVersion.Split()[0]
Major  Minor  Build  Revision
-----  -----  -----  --------
10     0      18362  356
</code></pre>
<h2 id="shell-variables">Shell Variables</h2>
<p>To delete all contents of USB drive (this is dangerous as it deletea all contents and files/dirs from a drive),</p>
<pre><code>Remove-Item -force l:\*
</code></pre>
<p>On pwsh,</p>
<pre><code>$ $profile
DocumentsDir\PowerShell\Microsoft.PowerShell_profile.ps1
</code></pre>
<p>On Powershell (Windows),</p>
<pre><code>$ $profile
DocumentsDir\\WindowsPowerShell\Microsoft.PowerShell_profile.ps1
</code></pre>
<p>Access history file,</p>
<pre><code>$ (Get-PSReadlineOption).HistorySavePath
</code></pre>
<h2 id="inception-to-powershell-from-pwsh">Inception to Powershell from pwsh</h2>
<p>Say you have a script named <code>Bluetooth.ps1</code> that uses Windows features. Hence, it requires Powershell.</p>
<pre><code>Powershell -NoProfile -File Bluetooth.ps1 On
</code></pre>
<h2 id="fixing-permission-for-pwsh-in-a-new-machine">Fixing permission for pwsh in a new machine</h2>
<p>Set execution policy for current user <a href="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.security/set-executionpolicy">ref</a>,</p>
<pre><code>Set-Executionpolicy Unrestricted -scope CurrentUser
</code></pre>
<p>In old days, that used to be enough. If you get following,</p>
<pre><code>PowerShell 6.2.3
Copyright (c) Microsoft Corporation. All rights reserved.

https://aka.ms/pscore6-docs
Type 'help' to get help.

Security warning
Run only scripts that you trust. While scripts from the internet can be useful, this script can potentially harm your computer. If you trust this script, use the Unblock-File cmdlet to allow the script to run without this warning
message. Do you want to run D:\Doc\PowerShell\Microsoft.PowerShell_profile.ps1?
[D] Do not run  [R] Run once  [S] Suspend  [?] Help (default is &quot;D&quot;): R
Loading personal and system profiles took 4862ms.
</code></pre>
<p>Try unblocking,</p>
<pre><code>Unblock-File D:\Doc\PowerShell\Microsoft.PowerShell_profile.ps1
</code></pre>
<p>In worst situation, in corporate environments if that still does not work,</p>
<pre><code>File D:\Doc\PowerShell\Microsoft.PowerShell_profile.ps1 cannot be loaded. The file D:\Doc\PowerShell\Microsoft.PowerShell_profile.ps1 is not digitally signed. You cannot run this script on the current system. For more information about running scripts and setting execution policy, see about_Execution_Policies at https://go.microsoft.com/fwlink/?LinkID=135170.
At line:1 char:3
+ . 'D:\Doc\PowerShell\Microsoft.PowerShell_profile.ps1'
+   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
+ CategoryInfo          : SecurityError: (:) [], PSSecurityException
+ FullyQualifiedErrorId : UnauthorizedAccess
</code></pre>
<p>we can apply bypass changing Registry,</p>
<pre><code>Set-ItemProperty -Path HKLM:\Software\Policies\Microsoft\Windows\PowerShell -Name ExecutionPolicy -Value ByPass
</code></pre>
<p>In environments like school computers that are running SINC Site, bypassing in Process scope can be useful,</p>
<pre><code>Set-ExecutionPolicy Bypass -Scope Process
</code></pre>
<h2 id="variables-pwsh-vs-powershell">Variables pwsh vs Powershell</h2>
<p>Following are new pwsh variables,</p>
<pre><code>EnabledExperimentalFeatures    {}

IsCoreCLR                      True
IsLinux                        False
IsMacOS                        False
isSinglePS                     True
IsWindows                      True
LASTEXITCODE                   0

psConsoleType
</code></pre>
<p>The shell modified following previously known Powershell variables,</p>
<pre><code>OutputEncoding
PROFILE
PSCommandPath
PSEdition
PSHOME
</code></pre>
<h3 id="chaning-window-size">Chaning Window Size</h3>
<p>To change Window ize we change buffer size first, because Window Size depends on it.</p>
<pre><code>$cUI = (Get-Host).UI.RawUI
$b = $cUI.BufferSize
$b.Width = $width
$b.Height = $history_size
$cUI.BufferSize = $b

# change window height and width
$b = $cUI.WindowSize
$b.Width = $width
$b.Height = $height
$cUI.WindowSize = $b
</code></pre>
<p>There's oneliner to do it as well,</p>
<pre><code>(Get-Host).UI.RawUI.BufferSize = New-Object System.Management.Automation.Host.Size -Property &#64;{Width=$width; Height=$history_size}
(Get-Host).UI.RawUI.WindowSize = New-Object System.Management.Automation.Host.Size -Property &#64;{Width=$width; Height=$height}
</code></pre>
<p>To change the title of the console we do,</p>
<pre><code>$cUI.WindowTitle = $title
</code></pre>
<p><a href="https://docs.microsoft.com/en-us/dotnet/api/system.management.automation.host.pshostuserinterface.rawui">ms docs ref</a></p>
<h2 id="continue">continue</h2>
<p>rest of the contents yet to be appended..</p>



						</div>
					</section>
				
				</section>
				
				<!-- Footer -->
                <footer id="footer">
                    <div class="inner">
    <section>
            <h2>Feeds</h2>
            <ul class="actions">
                <li><a href="/feed.rss" class="button small"><i class="fa fa-rss"></i> RSS Feed</a></li>
                                <li><a href="/feed.atom" class="button small"><i class="fa fa-rss"></i> Atom Feed</a></li>
            </ul>
    </section>
    <section>
    </section>
    <ul class="copyright">
        <li>Copyright © 2020</li>
        <li>Design: <a href="http://html5up.net">HTML5 UP</a></li>
        <li><a href="https://wyam.io">Generated by Wyam</a></li>
    </ul>
</div>
                </footer>
			</div>

		<!-- Scripts -->
			<script src="/assets/js/skel.min.js"></script>
			<script src="/assets/js/jquery.min.js"></script>
			<script src="/assets/js/jquery.scrollex.min.js"></script>
			<script src="/assets/js/util.js"></script>
            <!--[if lte IE 8]><script src="/assets/js/ie/respond.min.js"></script><![endif]-->
            <script src="/assets/js/main.js"></script>

	</body>

</html>